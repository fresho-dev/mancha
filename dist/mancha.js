(()=>{"use strict";var t={885:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.attributeNameToCamelCase=void 0,e.attributeNameToCamelCase=function(t){return t.replace(/-./g,(t=>t[1].toUpperCase()))}},246:function(t,e,i){var r,o,n,s,a=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const l=i(283);class c extends l.IRenderer{constructor(){super(...arguments),this.dirpath=(0,l.dirname)(self.location.href)}parseHTML(t,e={root:!1}){if(e.root)return(new DOMParser).parseFromString(t,"text/html");{const e=document.createRange();return e.selectNodeContents(document.body),e.createContextualFragment(t)}}serializeHTML(t){return(new XMLSerializer).serializeToString(t).replace(/\s?xmlns="[^"]+"/gm,"")}preprocessLocal(t,e){return this.preprocessRemote(t,e)}}const u=new c;self.Mancha=u;const d=null===(r=self.document)||void 0===r?void 0:r.currentScript;if(null===(n=null===(o=self.document)||void 0===o?void 0:o.currentScript)||void 0===n?void 0:n.hasAttribute("init")){u.update(Object.assign({},null==d?void 0:d.dataset));const t=null==d?void 0:d.hasAttribute("debug"),e=null==d?void 0:d.getAttribute("cache");((null===(s=null==d?void 0:d.getAttribute("target"))||void 0===s?void 0:s.split(","))||["body"]).map((i=>a(void 0,void 0,void 0,(function*(){const r=self.document.querySelector(i);yield u.mount(r,{cache:e,debug:t})}))))}e.default=u},283:function(t,e,i){var r=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.IRenderer=e.safeEval=e.isRelativePath=e.dirname=e.traverse=void 0;const o=i(63),n=i(150),s=i(230);function*a(t,e=new Set){const i=new Set,r=Array.from(t.childNodes).filter((t=>!e.has(t)));for(yield t;r.length;){const t=r.pop();i.has(t)||(i.add(t),yield t),t.childNodes&&Array.from(t.childNodes).filter((t=>!e.has(t))).forEach((t=>r.push(t)))}}function l(t){return t.includes("/")?t.split("/").slice(0,-1).join("/"):""}function c(t,e,i={}){const r=`with (this) { return (async () => (${t}))(); }`;return new Function(...Object.keys(i),r).call(e,...Object.values(i))}e.traverse=a,e.dirname=l,e.isRelativePath=function(t){return!(t.includes("://")||t.startsWith("/")||t.startsWith("#")||t.startsWith("data:"))},e.safeEval=c;class u extends o.ReactiveProxyStore{constructor(){super(...arguments),this.debugging=!1,this.dirpath="",this.skipNodes=new Set}debug(t){return this.debugging=t,this}fetchRemote(t,e){return r(this,void 0,void 0,(function*(){var i;return fetch(t,{cache:null!==(i=null==e?void 0:e.cache)&&void 0!==i?i:"default"}).then((t=>t.text()))}))}fetchLocal(t,e){return r(this,void 0,void 0,(function*(){return this.fetchRemote(t,e)}))}preprocessString(t,e){return r(this,void 0,void 0,(function*(){this.log("Preprocessing string content with params:\n",e);const i=this.parseHTML(t,e);return yield this.preprocessNode(i,e),i}))}preprocessLocal(t,e){return r(this,void 0,void 0,(function*(){var i;const r=yield this.fetchLocal(t,e);return this.preprocessString(r,Object.assign(Object.assign({},e),{dirpath:l(t),root:null!==(i=null==e?void 0:e.root)&&void 0!==i?i:!t.endsWith(".tpl.html")}))}))}preprocessRemote(t,e){return r(this,void 0,void 0,(function*(){var i;const r=(null==e?void 0:e.cache)||"default",o=yield fetch(t,{cache:r}).then((t=>t.text()));return this.preprocessString(o,Object.assign(Object.assign({},e),{dirpath:l(t),root:null!==(i=null==e?void 0:e.root)&&void 0!==i?i:!t.endsWith(".tpl.html")}))}))}clone(){return new this.constructor(Object.fromEntries(this.store.entries()))}log(...t){this.debugging&&console.debug(...t)}eval(t){return r(this,arguments,void 0,(function*(t,e={},i){const o=[],n=()=>r(this,void 0,void 0,(function*(){const[s,a]=yield this.trace((function(){return r(this,void 0,void 0,(function*(){return yield c(t,this,Object.assign({},e))}))}));return this.log(`eval \`${t}\` => `,s,`[ ${a.join(", ")} ]`),o.length>0&&this.unwatch(o,n),o.splice(0,o.length,...a),this.watch(a,n),yield null==i?void 0:i(s,a),[s,a]}));return n()}))}preprocessNode(t,e){return r(this,void 0,void 0,(function*(){e=Object.assign({dirpath:this.dirpath,maxdepth:10},e);const i=new n.Iterator(a(t,this.skipNodes)).map((t=>r(this,void 0,void 0,(function*(){this.log("Preprocessing node:\n",t),yield s.resolveIncludes.call(this,t,e),yield s.rebaseRelativePaths.call(this,t,e)}))));yield Promise.all(i.generator())}))}renderNode(t,e){return r(this,void 0,void 0,(function*(){for(const i of a(t,this.skipNodes))this.log("Rendering node:\n",i),yield s.resolveDataAttribute.call(this,i,e),yield s.resolveForAttribute.call(this,i,e),yield s.resolveHtmlAttribute.call(this,i,e),yield s.resolveShowAttribute.call(this,i,e),yield s.resolveWatchAttribute.call(this,i,e),yield s.resolveBindAttribute.call(this,i,e),yield s.resolvePropAttributes.call(this,i,e),yield s.resolveAttrAttributes.call(this,i,e),yield s.resolveEventAttributes.call(this,i,e),yield s.resolveTextNodeExpressions.call(this,i,e)}))}mount(t,e){return r(this,void 0,void 0,(function*(){yield this.preprocessNode(t,e),yield this.renderNode(t,e)}))}}e.IRenderer=u},150:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Iterator=void 0;class i{constructor(t){this.iterable=t}filter(t){return new i(i.filterGenerator(t,this.iterable))}map(t){return new i(i.mapGenerator(t,this.iterable))}array(){return Array.from(this.iterable)}*generator(){for(const t of this.iterable)yield t}static*filterGenerator(t,e){for(const i of e)t(i)&&(yield i)}static*mapGenerator(t,e){for(const i of e)yield t(i)}static equals(t,e){const i=t[Symbol.iterator](),r=e[Symbol.iterator]();let o=i.next(),n=r.next();for(;!o.done&&!n.done;){if(o.value!==n.value)return!1;o=i.next(),n=r.next()}return o.done===n.done}}e.Iterator=i},230:function(t,e,i){var r=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.resolveShowAttribute=e.resolveBindAttribute=e.resolveForAttribute=e.resolveEventAttributes=e.resolveAttrAttributes=e.resolvePropAttributes=e.resolveHtmlAttribute=e.resolveWatchAttribute=e.resolveDataAttribute=e.resolveTextNodeExpressions=e.rebaseRelativePaths=e.resolveIncludes=void 0;const o=i(885),n=i(283),s=new Set([":bind",":bind-events",":data",":for",":show","@watch","$html"]),a={$text:"$text-content"};e.resolveIncludes=function(t,e){return r(this,void 0,void 0,(function*(){var i,r,o,n;const s=t;if("include"!==(null===(i=s.tagName)||void 0===i?void 0:i.toLocaleLowerCase()))return;this.log("<include> tag found in:\n",t),this.log("<include> params:",e);const a=null===(r=s.getAttribute)||void 0===r?void 0:r.call(s,"src");if(!a)throw new Error(`"src" attribute missing from ${t}.`);const l=e=>{t.replaceWith(...Array.from(e.childNodes))},c=Object.assign(Object.assign({},e),{root:!1,maxdepth:e.maxdepth-1});if(0===c.maxdepth)throw new Error("Maximum recursion depth reached.");if(a.includes("://")||a.startsWith("//"))this.log("Including remote file from absolute path:",a),yield this.preprocessRemote(a,c).then(l);else if((null===(o=e.dirpath)||void 0===o?void 0:o.includes("://"))||(null===(n=e.dirpath)||void 0===n?void 0:n.startsWith("//"))){const t=e.dirpath&&"."!==e.dirpath?`${e.dirpath}/${a}`:a;this.log("Including remote file from relative path:",t),yield this.preprocessRemote(t,c).then(l)}else if("/"===a.charAt(0))this.log("Including local file from absolute path:",a),yield this.preprocessLocal(a,c).then(l);else{const t=e.dirpath&&"."!==e.dirpath?`${e.dirpath}/${a}`:a;this.log("Including local file from relative path:",t),yield this.preprocessLocal(t,c).then(l)}}))},e.rebaseRelativePaths=function(t,e){return r(this,void 0,void 0,(function*(){var i,r,o,s,a,l,c;const u=t,d=null===(i=u.tagName)||void 0===i?void 0:i.toLowerCase();if(!e.dirpath)return;const h=null===(o=(r=t).getAttribute)||void 0===o?void 0:o.call(r,"src"),v=null===(a=(s=t).getAttribute)||void 0===a?void 0:a.call(s,"href"),f=null===(c=(l=t).getAttribute)||void 0===c?void 0:c.call(l,"data"),p=h||v||f;p&&(p&&(0,n.isRelativePath)(p)&&this.log("Rebasing relative path as:",e.dirpath,"/",p),"img"===d&&h&&(0,n.isRelativePath)(h)?u.src=`${e.dirpath}/${h}`:"a"===d&&v&&(0,n.isRelativePath)(v)||"link"===d&&v&&(0,n.isRelativePath)(v)?u.href=`${e.dirpath}/${v}`:"script"===d&&h&&(0,n.isRelativePath)(h)||"source"===d&&h&&(0,n.isRelativePath)(h)||"audio"===d&&h&&(0,n.isRelativePath)(h)||"video"===d&&h&&(0,n.isRelativePath)(h)||"track"===d&&h&&(0,n.isRelativePath)(h)||"iframe"===d&&h&&(0,n.isRelativePath)(h)?u.src=`${e.dirpath}/${h}`:"object"===d&&f&&(0,n.isRelativePath)(f)?u.data=`${e.dirpath}/${f}`:"input"===d&&h&&(0,n.isRelativePath)(h)?u.src=`${e.dirpath}/${h}`:("area"===d&&v&&(0,n.isRelativePath)(v)||"base"===d&&v&&(0,n.isRelativePath)(v))&&(u.href=`${e.dirpath}/${v}`))}))},e.resolveTextNodeExpressions=function(t,e){return r(this,void 0,void 0,(function*(){if(3!==t.nodeType)return;const e=t.nodeValue||"";this.log("processing node content value:\n",e);const i=new RegExp(/{{ ([^}]+) }}/gm),o=Array.from(e.matchAll(i)).map((t=>t[1])),n=()=>r(this,void 0,void 0,(function*(){let i=e;for(const e of o){const[r]=yield this.eval(e,{$elem:t});i=i.replace(`{{ ${e} }}`,String(r))}t.nodeValue=i}));yield Promise.all(o.map((e=>this.eval(e,{$elem:t},n))))}))},e.resolveDataAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var e;if(this.skipNodes.has(t))return;const i=t,r=null===(e=i.getAttribute)||void 0===e?void 0:e.call(i,":data");if(r){this.log(":data attribute found in:\n",t),i.removeAttribute(":data");const[e]=yield this.eval(r,{$elem:t});yield this.update(e)}}))},e.resolveWatchAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var e;if(this.skipNodes.has(t))return;const i=t,r=null===(e=i.getAttribute)||void 0===e?void 0:e.call(i,"@watch");r&&(this.log("@watch attribute found in:\n",t),i.removeAttribute("@watch"),yield this.eval(r,{$elem:t},(()=>{})))}))},e.resolveHtmlAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var i;if(this.skipNodes.has(t))return;const o=t,n=null===(i=o.getAttribute)||void 0===i?void 0:i.call(o,"$html");if(n){this.log("$html attribute found in:\n",t),o.removeAttribute("$html");const i=this.clone();yield this.eval(n,{$elem:t},(t=>r(this,void 0,void 0,(function*(){const r=yield i.preprocessString(t,e);yield i.renderNode(r,e),o.replaceChildren(r)}))))}}))},e.resolvePropAttributes=function(t,e){return r(this,void 0,void 0,(function*(){if(this.skipNodes.has(t))return;const e=t;for(const i of Array.from(e.attributes||[]))if(i.name.startsWith("$")&&!s.has(i.name)){this.log(i.name,"attribute found in:\n",t),e.removeAttribute(i.name);const r=(a[i.name]||i.name).slice(1),n=(0,o.attributeNameToCamelCase)(r);yield this.eval(i.value,{$elem:t},(e=>t[n]=e))}}))},e.resolveAttrAttributes=function(t,e){return r(this,void 0,void 0,(function*(){if(this.skipNodes.has(t))return;const e=t;for(const i of Array.from(e.attributes||[]))if(i.name.startsWith(":")&&!s.has(i.name)){this.log(i.name,"attribute found in:\n",t),e.removeAttribute(i.name);const r=(a[i.name]||i.name).slice(1);yield this.eval(i.value,{$elem:t},(t=>e.setAttribute(r,t)))}}))},e.resolveEventAttributes=function(t,e){return r(this,void 0,void 0,(function*(){var e;if(this.skipNodes.has(t))return;const i=t;for(const r of Array.from(i.attributes||[]))r.name.startsWith("@")&&!s.has(r.name)&&(this.log(r.name,"attribute found in:\n",t),i.removeAttribute(r.name),null===(e=t.addEventListener)||void 0===e||e.call(t,r.name.substring(1),(e=>this.eval(r.value,{$elem:t,$event:e}))))}))},e.resolveForAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var i,o;if(this.skipNodes.has(t))return;const s=t,a=null===(o=null===(i=s.getAttribute)||void 0===i?void 0:i.call(s,":for"))||void 0===o?void 0:o.trim();if(a){this.log(":for attribute found in:\n",t),s.removeAttribute(":for");for(const e of(0,n.traverse)(t,this.skipNodes))this.skipNodes.add(e);const i=t.parentNode,o=t.ownerDocument.createElement("template");i.insertBefore(o,t),o.append(t),this.log(":for template:\n",o);const l=a.split(" in ",2);if(2!==l.length)throw new Error(`Invalid :for format: \`${a}\`. Expected "{key} in {expression}".`);const c=[],[u,d]=l;yield this.eval(d,{$elem:t},(n=>(this.log(":for list items:",n),this.lock=this.lock.then((()=>new Promise((s=>r(this,void 0,void 0,(function*(){if(c.splice(0,c.length).forEach((t=>{i.removeChild(t),this.skipNodes.delete(t)})),!Array.isArray(n))return console.error(`Expression did not yield a list: \`${d}\` => \`${n}\``),s();for(const r of n.slice(0).reverse()){const n=this.clone();yield n.set(u,r);const s=t.cloneNode(!0);i.insertBefore(s,o.nextSibling),c.push(s),this.skipNodes.add(s),yield n.mount(s,e),this.log("Rendered list child:\n",s)}s()})))))),this.lock)))}}))},e.resolveBindAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var e,i,r;if(this.skipNodes.has(t))return;const o=t,n=null===(e=o.getAttribute)||void 0===e?void 0:e.call(o,":bind");if(n){this.log(":bind attribute found in:\n",t);const e=["change","input"],s=(null===(r=null===(i=o.getAttribute)||void 0===i?void 0:i.call(o,":bind-events"))||void 0===r?void 0:r.split(","))||e;o.removeAttribute(":bind"),o.removeAttribute(":bind-events");const a="checkbox"===o.getAttribute("type")?"checked":"value";this.has(n)||(yield this.set(n,o[a])),o[a]=this.get(n);for(const e of s)t.addEventListener(e,(()=>this.set(n,o[a])));this.watch([n],(()=>o[a]=this.get(n)))}}))},e.resolveShowAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var e;if(this.skipNodes.has(t))return;const i=t,r=null===(e=i.getAttribute)||void 0===e?void 0:e.call(i,":show");if(r){this.log(":show attribute found in:\n",t),i.removeAttribute(":show");const e="none"===i.style.display?"":i.style.display;yield this.eval(r,{$elem:t},(t=>{i.style.display=t?e:"none"}))}}))}},63:function(t,e){var i=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.proxifyStore=e.ReactiveProxyStore=e.InertProxy=e.ReactiveProxy=e.proxifyObject=e.REACTIVE_DEBOUNCE_MILLIS=void 0;class r{constructor(){this.timeouts=new Map}debounce(t,e){return new Promise(((i,r)=>{const o=this.timeouts.get(e);o&&clearTimeout(o),this.timeouts.set(e,setTimeout((()=>{try{i(e()),this.timeouts.delete(e)}catch(t){r(t)}}),t))}))}}function o(t,e,i=!0){if(null==t||function(t){return t instanceof n||t.__is_proxy__}(t))return t;if(i)for(const i in t)t.hasOwnProperty(i)&&"object"==typeof t[i]&&null!=t[i]&&(t[i]=o(t[i],e));return new Proxy(t,{deleteProperty:(t,i)=>i in t&&(delete t[i],e(),!0),set:(t,r,n,s)=>{i&&"object"==typeof n&&(n=o(n,e));const a=Reflect.set(t,r,n,s);return e(),a},get:(t,e,i)=>"__is_proxy__"===e||Reflect.get(t,e,i)})}e.REACTIVE_DEBOUNCE_MILLIS=25,e.proxifyObject=o;class n extends r{constructor(t=null,...e){super(),this.value=null,this.listeners=[],this.value=this.wrapObjValue(t),e.forEach((t=>this.watch(t)))}static from(t,...e){return t instanceof n?(e.forEach(t.watch),t):new n(t,...e)}wrapObjValue(t){return null===t||"object"!=typeof t?t:o(t,(()=>this.trigger()))}get(){return this.value}set(t){return i(this,void 0,void 0,(function*(){if(this.value!==t){const e=this.value;this.value=this.wrapObjValue(t),yield this.trigger(e)}}))}watch(t){this.listeners.push(t)}unwatch(t){this.listeners=this.listeners.filter((e=>e!==t))}trigger(t=null){const i=this.listeners.slice();return this.debounce(e.REACTIVE_DEBOUNCE_MILLIS,(()=>Promise.all(i.map((e=>e(this.value,t)))).then((()=>{}))))}}e.ReactiveProxy=n;class s extends n{static from(t,...e){return t instanceof n?t:new s(t,...e)}watch(t){}trigger(t){return Promise.resolve()}}function a(t,e=(()=>{})){const i=Array.from(t.entries()).map((([t])=>t)),r=Object.fromEntries(i.map((t=>[t,void 0])));return new Proxy(Object.assign({},t,r),{get:(i,r,o)=>"string"==typeof r&&t.has(r)?(e("get",r),t.get(r)):"get"===r?i=>(e("get",i),t.get(i)):Reflect.get(t,r,o),set:(i,r,o,n)=>("string"!=typeof r||r in t?Reflect.set(t,r,o,n):(e("set",r,o),t.set(r,o)),!0)})}e.InertProxy=s,e.ReactiveProxyStore=class extends r{constructor(t){super(),this.store=new Map,this.lock=Promise.resolve();for(const[e,i]of Object.entries(t||{}))this.store.set(e,n.from(this.wrapFnValue(i)))}wrapFnValue(t){return t&&"function"==typeof t?(...e)=>t.call(a(this),...e):t}get $(){return a(this)}entries(){return this.store.entries()}get(t){var e;return null===(e=this.store.get(t))||void 0===e?void 0:e.get()}set(t,e){return i(this,void 0,void 0,(function*(){this.store.has(t)?yield this.store.get(t).set(this.wrapFnValue(e)):this.store.set(t,n.from(this.wrapFnValue(e)))}))}del(t){return this.store.delete(t)}has(t){return this.store.has(t)}update(t){return i(this,void 0,void 0,(function*(){yield Promise.all(Object.entries(t).map((([t,e])=>this.set(t,e))))}))}watch(t,i){t=Array.isArray(t)?t:[t];const r=()=>i(...t.map((t=>this.store.get(t).get())));t.forEach((t=>this.store.get(t).watch((()=>this.debounce(e.REACTIVE_DEBOUNCE_MILLIS,r)))))}unwatch(t,e){(t=Array.isArray(t)?t:[t]).forEach((t=>this.store.get(t).unwatch(e)))}trigger(t){return i(this,void 0,void 0,(function*(){t=Array.isArray(t)?t:[t],yield Promise.all(t.map((t=>this.store.get(t).trigger())))}))}trace(t){return i(this,void 0,void 0,(function*(){const e=new Set,i=a(this,((t,i)=>{"get"===t&&e.add(i)}));return[yield t.call(i),Array.from(e)]}))}computed(t,e){return i(this,void 0,void 0,(function*(){const[r,o]=yield this.trace(e);this.watch(o,(()=>i(this,void 0,void 0,(function*(){return this.set(t,yield e.call(a(this)))})))),this.set(t,r)}))}},e.proxifyStore=a}},e={};!function i(r){var o=e[r];if(void 0!==o)return o.exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,i),n.exports}(246)})();