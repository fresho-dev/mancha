(()=>{"use strict";var t={885:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.attributeNameToCamelCase=void 0,e.attributeNameToCamelCase=function(t){return t.replace(/-./g,(t=>t[1].toUpperCase()))}},246:function(t,e,i){var r,o,s,n,a=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,s){function n(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const l=i(283);class c extends l.IRenderer{constructor(){super(...arguments),this.dirpath=(0,l.dirname)(self.location.href)}parseHTML(t,e={root:!1}){if(e.root)return(new DOMParser).parseFromString(t,"text/html");{const e=document.createRange();return e.selectNodeContents(document.body),e.createContextualFragment(t)}}serializeHTML(t){return(new XMLSerializer).serializeToString(t).replace(/\s?xmlns="[^"]+"/gm,"")}preprocessLocal(t,e){return this.preprocessRemote(t,e)}}const h=new c;self.Mancha=h;const u=null===(r=self.document)||void 0===r?void 0:r.currentScript;if(null===(s=null===(o=self.document)||void 0===o?void 0:o.currentScript)||void 0===s?void 0:s.hasAttribute("init")){h.update(Object.assign({},null==u?void 0:u.dataset));const t=null==u?void 0:u.hasAttribute("debug"),e=null==u?void 0:u.getAttribute("cache");((null===(n=null==u?void 0:u.getAttribute("target"))||void 0===n?void 0:n.split(","))||["body"]).map((i=>a(void 0,void 0,void 0,(function*(){const r=self.document.querySelector(i);yield h.mount(r,{cache:e,debug:t})}))))}e.default=h},283:function(t,e,i){var r=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,s){function n(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.IRenderer=e.safeEval=e.isRelativePath=e.dirname=e.traverse=void 0;const o=i(63),s=i(150),n=i(230);function*a(t,e=new Set){const i=new Set,r=Array.from(t.childNodes).filter((t=>!e.has(t)));for(yield t;r.length;){const t=r.pop();i.has(t)||(i.add(t),yield t),t.childNodes&&Array.from(t.childNodes).filter((t=>!e.has(t))).forEach((t=>r.push(t)))}}function l(t){return t.includes("/")?t.split("/").slice(0,-1).join("/"):""}function c(t,e,i={}){const r=`with (this) { return (async () => (${t}))(); }`;return new Function(...Object.keys(i),r).call(e,...Object.values(i))}e.traverse=a,e.dirname=l,e.isRelativePath=function(t){return!(t.includes("://")||t.startsWith("/")||t.startsWith("#")||t.startsWith("data:"))},e.safeEval=c;class h extends o.ReactiveProxyStore{constructor(){super(...arguments),this.dirpath="",this.skipNodes=new Set}fetchRemote(t,e){return r(this,void 0,void 0,(function*(){var i;return fetch(t,{cache:null!==(i=null==e?void 0:e.cache)&&void 0!==i?i:"default"}).then((t=>t.text()))}))}fetchLocal(t,e){return r(this,void 0,void 0,(function*(){return this.fetchRemote(t,e)}))}preprocessString(t,e){return r(this,void 0,void 0,(function*(){this.log(e,"Preprocessing string content with params:\n",e);const i=this.parseHTML(t,e);return yield this.preprocessNode(i,e),i}))}preprocessLocal(t,e){return r(this,void 0,void 0,(function*(){var i;const r=yield this.fetchLocal(t,e);return this.preprocessString(r,Object.assign(Object.assign({},e),{dirpath:l(t),root:null!==(i=null==e?void 0:e.root)&&void 0!==i?i:!t.endsWith(".tpl.html")}))}))}preprocessRemote(t,e){return r(this,void 0,void 0,(function*(){var i;const r=(null==e?void 0:e.cache)||"default",o=yield fetch(t,{cache:r}).then((t=>t.text()));return this.preprocessString(o,Object.assign(Object.assign({},e),{dirpath:l(t),root:null!==(i=null==e?void 0:e.root)&&void 0!==i?i:!t.endsWith(".tpl.html")}))}))}clone(){return new this.constructor(Object.fromEntries(this.store.entries()))}log(t,...e){(null==t?void 0:t.debug)&&console.debug(...e)}eval(t){return r(this,arguments,void 0,(function*(t,e={},i){const r=(0,o.proxify)(this),s=yield c(t,r,Object.assign({},e));return this.log(i,`eval \`${t}\` => `,s),s}))}preprocessNode(t,e){return r(this,void 0,void 0,(function*(){e=Object.assign({dirpath:this.dirpath,maxdepth:10},e);const i=new s.Iterator(a(t,this.skipNodes)).map((t=>r(this,void 0,void 0,(function*(){this.log(e,"Preprocessing node:\n",t),yield n.resolveIncludes.call(this,t,e),yield n.rebaseRelativePaths.call(this,t,e)}))));yield Promise.all(i.generator())}))}renderNode(t,e){return r(this,void 0,void 0,(function*(){for(const i of a(t,this.skipNodes))this.log(e,"Rendering node:\n",i),yield n.resolveDataAttribute.call(this,i,e),yield n.resolveForAttribute.call(this,i,e),yield n.resolveHtmlAttribute.call(this,i,e),yield n.resolveShowAttribute.call(this,i,e),yield n.resolveWatchAttribute.call(this,i,e),yield n.resolveBindAttribute.call(this,i,e),yield n.resolvePropAttributes.call(this,i,e),yield n.resolveAttrAttributes.call(this,i,e),yield n.resolveEventAttributes.call(this,i,e),yield n.resolveTextNodeExpressions.call(this,i,e)}))}mount(t,e){return r(this,void 0,void 0,(function*(){yield this.preprocessNode(t,e),yield this.renderNode(t,e)}))}}e.IRenderer=h},150:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Iterator=void 0;class i{constructor(t){this.iterable=t}filter(t){return new i(i.filterGenerator(t,this.iterable))}map(t){return new i(i.mapGenerator(t,this.iterable))}array(){return Array.from(this.iterable)}*generator(){for(const t of this.iterable)yield t}static*filterGenerator(t,e){for(const i of e)t(i)&&(yield i)}static*mapGenerator(t,e){for(const i of e)yield t(i)}}e.Iterator=i},230:function(t,e,i){var r=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,s){function n(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.resolveShowAttribute=e.resolveBindAttribute=e.resolveForAttribute=e.resolveEventAttributes=e.resolveAttrAttributes=e.resolvePropAttributes=e.resolveHtmlAttribute=e.resolveWatchAttribute=e.resolveDataAttribute=e.resolveTextNodeExpressions=e.rebaseRelativePaths=e.resolveIncludes=void 0;const o=i(885),s=i(283),n=new Set([":bind",":bind-events",":data",":for",":show","@watch","$html"]),a={$text:"$text-content"};e.resolveIncludes=function(t,e){return r(this,void 0,void 0,(function*(){var i,r,o,s;const n=t;if("include"!==(null===(i=n.tagName)||void 0===i?void 0:i.toLocaleLowerCase()))return;this.log(e,"<include> tag found in:\n",t),this.log(e,"<include> params:",e);const a=null===(r=n.getAttribute)||void 0===r?void 0:r.call(n,"src");if(!a)throw new Error(`"src" attribute missing from ${t}.`);const l=e=>{t.replaceWith(...Array.from(e.childNodes))},c=Object.assign(Object.assign({},e),{root:!1,maxdepth:e.maxdepth-1});if(0===c.maxdepth)throw new Error("Maximum recursion depth reached.");if(a.includes("://")||a.startsWith("//"))this.log(e,"Including remote file from absolute path:",a),yield this.preprocessRemote(a,c).then(l);else if((null===(o=e.dirpath)||void 0===o?void 0:o.includes("://"))||(null===(s=e.dirpath)||void 0===s?void 0:s.startsWith("//"))){const t=e.dirpath&&"."!==e.dirpath?`${e.dirpath}/${a}`:a;this.log(e,"Including remote file from relative path:",t),yield this.preprocessRemote(t,c).then(l)}else if("/"===a.charAt(0))this.log(e,"Including local file from absolute path:",a),yield this.preprocessLocal(a,c).then(l);else{const t=e.dirpath&&"."!==e.dirpath?`${e.dirpath}/${a}`:a;this.log(e,"Including local file from relative path:",t),yield this.preprocessLocal(t,c).then(l)}}))},e.rebaseRelativePaths=function(t,e){return r(this,void 0,void 0,(function*(){var i,r,o,n,a,l,c;const h=t,u=null===(i=h.tagName)||void 0===i?void 0:i.toLowerCase();if(!e.dirpath)return;const d=null===(o=(r=t).getAttribute)||void 0===o?void 0:o.call(r,"src"),v=null===(a=(n=t).getAttribute)||void 0===a?void 0:a.call(n,"href"),f=null===(c=(l=t).getAttribute)||void 0===c?void 0:c.call(l,"data"),p=d||v||f;p&&(p&&(0,s.isRelativePath)(p)&&this.log(e,"Rebasing relative path as:",e.dirpath,"/",p),"img"===u&&d&&(0,s.isRelativePath)(d)?h.src=`${e.dirpath}/${d}`:"a"===u&&v&&(0,s.isRelativePath)(v)||"link"===u&&v&&(0,s.isRelativePath)(v)?h.href=`${e.dirpath}/${v}`:"script"===u&&d&&(0,s.isRelativePath)(d)||"source"===u&&d&&(0,s.isRelativePath)(d)||"audio"===u&&d&&(0,s.isRelativePath)(d)||"video"===u&&d&&(0,s.isRelativePath)(d)||"track"===u&&d&&(0,s.isRelativePath)(d)||"iframe"===u&&d&&(0,s.isRelativePath)(d)?h.src=`${e.dirpath}/${d}`:"object"===u&&f&&(0,s.isRelativePath)(f)?h.data=`${e.dirpath}/${f}`:"input"===u&&d&&(0,s.isRelativePath)(d)?h.src=`${e.dirpath}/${d}`:("area"===u&&v&&(0,s.isRelativePath)(v)||"base"===u&&v&&(0,s.isRelativePath)(v))&&(h.href=`${e.dirpath}/${v}`))}))},e.resolveTextNodeExpressions=function(t,e){return r(this,void 0,void 0,(function*(){if(3!==t.nodeType)return;const i=t.nodeValue||"",o=new RegExp(/{{ ([^}]+) }}/gm),s=Array.from(i.matchAll(o)).map((t=>t[1])),n=()=>r(this,void 0,void 0,(function*(){let r=i;for(const i of s){const o=yield this.eval(i,{$elem:t},e);r=r.replace(`{{ ${i} }}`,String(o))}t.nodeValue=r})),[a,l]=yield this.trace(n);this.log(e,i,"=>",a),this.watch(l,n)}))},e.resolveDataAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var i;if(this.skipNodes.has(t))return;const r=t,o=null===(i=r.getAttribute)||void 0===i?void 0:i.call(r,":data");if(o){this.log(e,":data attribute found in:\n",t),r.removeAttribute(":data");const i=yield this.eval(o,{$elem:t},e);this.log(e,":data",o,"=>",i),yield this.update(i)}}))},e.resolveWatchAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var i;if(this.skipNodes.has(t))return;const r=t,o=null===(i=r.getAttribute)||void 0===i?void 0:i.call(r,"@watch");if(o){this.log(e,"@watch attribute found in:\n",t),r.removeAttribute("@watch");const i=()=>this.eval(o,{$elem:t},e),[s,n]=yield this.trace(i);this.log(e,"@watch",o,"=>",s),this.watch(n,i)}}))},e.resolveHtmlAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var i;if(this.skipNodes.has(t))return;const o=t,s=null===(i=o.getAttribute)||void 0===i?void 0:i.call(o,"$html");if(s){this.log(e,"$html attribute found in:\n",t),o.removeAttribute("$html");const i=this.clone(),n=()=>r(this,void 0,void 0,(function*(){const r=yield this.eval(s,{$elem:t},e),n=yield i.preprocessString(r,e);yield i.renderNode(n,e),o.replaceChildren(n)})),[a,l]=yield this.trace(n);this.log(e,"$html",s,"=>",a),this.watch(l,n)}}))},e.resolvePropAttributes=function(t,e){return r(this,void 0,void 0,(function*(){if(this.skipNodes.has(t))return;const i=t;for(const s of Array.from(i.attributes||[]))if(s.name.startsWith("$")&&!n.has(s.name)){this.log(e,s.name,"attribute found in:\n",t),i.removeAttribute(s.name);const n=(a[s.name]||s.name).slice(1),l=()=>this.eval(s.value,{$elem:t},e),[c,h]=yield this.trace(l);this.log(e,s.name,s.value,"=>",c,`[${h}]`);const u=(0,o.attributeNameToCamelCase)(n);this.watch(h,(()=>r(this,void 0,void 0,(function*(){return t[u]=yield l()})))),t[u]=c}}))},e.resolveAttrAttributes=function(t,e){return r(this,void 0,void 0,(function*(){if(this.skipNodes.has(t))return;const i=t;for(const o of Array.from(i.attributes||[]))if(o.name.startsWith(":")&&!n.has(o.name)){this.log(e,o.name,"attribute found in:\n",t),i.removeAttribute(o.name);const s=(a[o.name]||o.name).slice(1),n=()=>this.eval(o.value,{$elem:t},e),[l,c]=yield this.trace(n);this.log(e,o.name,o.value,"=>",l,`[${c}]`),this.watch(c,(()=>r(this,void 0,void 0,(function*(){return i.setAttribute(s,yield n())})))),i.setAttribute(s,l)}}))},e.resolveEventAttributes=function(t,e){return r(this,void 0,void 0,(function*(){var i;if(this.skipNodes.has(t))return;const r=t;for(const o of Array.from(r.attributes||[]))o.name.startsWith("@")&&!n.has(o.name)&&(this.log(e,o.name,"attribute found in:\n",t),r.removeAttribute(o.name),null===(i=t.addEventListener)||void 0===i||i.call(t,o.name.substring(1),(i=>this.eval(o.value,{$elem:t,$event:i},e))))}))},e.resolveForAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var i,o;if(this.skipNodes.has(t))return;const n=t,a=null===(o=null===(i=n.getAttribute)||void 0===i?void 0:i.call(n,":for"))||void 0===o?void 0:o.trim();if(a){this.log(e,":for attribute found in:\n",t),n.removeAttribute(":for");for(const e of(0,s.traverse)(t,this.skipNodes))this.skipNodes.add(e);const i=t.parentNode,o=t.ownerDocument.createElement("template");i.insertBefore(o,t),o.append(t),this.log(e,":for template:\n",o);const l=a.split(" in ",2);if(2!==l.length)throw new Error(`Invalid :for format: \`${a}\`. Expected "{key} in {expression}".`);let c=[],h=[];const[u,d]=l;try{[c,h]=yield this.trace((()=>this.eval(d,{$elem:t},e))),this.log(e,d,"=>",c,`[${h}]`)}catch(t){return void console.error(t)}const v=[],f=s=>r(this,void 0,void 0,(function*(){if(this.log(e,":for list items:",s),Array.isArray(s))return this.lock=this.lock.then((()=>new Promise((n=>r(this,void 0,void 0,(function*(){v.splice(0,v.length).forEach((t=>{i.removeChild(t),this.skipNodes.delete(t)}));for(const r of s.slice(0).reverse()){const s=this.clone();yield s.set(u,r);const n=t.cloneNode(!0);i.insertBefore(n,o.nextSibling),v.push(n),this.skipNodes.add(n),yield s.mount(n,e),this.log(e,"Rendered list child:\n",n)}n()})))))),this.lock;console.error(`Expression did not yield a list: \`${d}\` => \`${s}\``)}));return this.watch(h,(()=>r(this,void 0,void 0,(function*(){return f(yield this.eval(d,{$elem:t},e))})))),f(c)}}))},e.resolveBindAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var i,r,o;if(this.skipNodes.has(t))return;const s=t,n=null===(i=s.getAttribute)||void 0===i?void 0:i.call(s,":bind");if(n){this.log(e,":bind attribute found in:\n",t);const i=["change","input"],a=(null===(o=null===(r=s.getAttribute)||void 0===r?void 0:r.call(s,":bind-events"))||void 0===o?void 0:o.split(","))||i;s.removeAttribute(":bind"),s.removeAttribute(":bind-events");const l="checkbox"===s.getAttribute("type")?"checked":"value";this.has(n)||(yield this.set(n,s[l])),s[l]=this.get(n);for(const e of a)t.addEventListener(e,(()=>this.set(n,s[l])));this.watch([n],(()=>s[l]=this.get(n)))}}))},e.resolveShowAttribute=function(t,e){return r(this,void 0,void 0,(function*(){var i;if(this.skipNodes.has(t))return;const o=t,s=null===(i=o.getAttribute)||void 0===i?void 0:i.call(o,":show");if(s){this.log(e,":show attribute found in:\n",t),o.removeAttribute(":show");const i=()=>this.eval(s,{$elem:t},e),[n,a]=yield this.trace(i);this.log(e,":show",s,"=>",n,`[${a}]`);const l="none"===o.style.display?"":o.style.display;n||(o.style.display="none"),this.watch(a,(()=>r(this,void 0,void 0,(function*(){o.style.display=(yield i())?l:"none"}))))}}))}},63:function(t,e){var i=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,s){function n(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.proxify=e.ReactiveProxyStore=e.InertProxy=e.ReactiveProxy=e.proxifyObject=e.REACTIVE_DEBOUNCE_MILLIS=void 0;class r{constructor(){this.timeout=null}debounce(t,e){return new Promise(((i,r)=>{this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>{try{i(e())}catch(t){r(t)}}),t)}))}}function o(t,e,i=!0){if(null==t||function(t){return t instanceof s||t.__is_proxy__}(t))return t;if(i)for(const i in t)t.hasOwnProperty(i)&&"object"==typeof t[i]&&null!=t[i]&&(t[i]=o(t[i],e));return new Proxy(t,{deleteProperty:(t,i)=>i in t&&(delete t[i],e(),!0),set:(t,r,s,n)=>{i&&"object"==typeof s&&(s=o(s,e));const a=Reflect.set(t,r,s,n);return e(),a},get:(t,e,i)=>"__is_proxy__"===e||Reflect.get(t,e,i)})}e.REACTIVE_DEBOUNCE_MILLIS=25,e.proxifyObject=o;class s extends r{constructor(t=null,...e){super(),this.value=null,this.listeners=[],this.set(t),e.forEach((t=>this.watch(t)))}static from(t,...e){return t instanceof s?(e.forEach(t.watch),t):new s(t,...e)}get(){return this.value}set(t){return i(this,void 0,void 0,(function*(){if(this.value!==t){const e=this.value;null!=t&&"object"==typeof t&&(t=o(t,(()=>this.trigger()))),this.value=t,yield this.trigger(e)}}))}watch(t){this.listeners.push(t)}unwatch(t){this.listeners=this.listeners.filter((e=>e!==t))}trigger(){return i(this,arguments,void 0,(function*(t=null){yield this.debounce(e.REACTIVE_DEBOUNCE_MILLIS,(()=>Promise.all(this.listeners.map((e=>e(this.value,t))))))}))}}e.ReactiveProxy=s;class n extends s{static from(t,...e){return t instanceof s?t:new n(t,...e)}watch(t){}trigger(t){return Promise.resolve()}}function a(t){const e=Array.from(t.entries()).map((([t])=>t)),i=Object.fromEntries(e.map((t=>[t,void 0])));return new Proxy(Object.assign({},t,i),{get:(e,i,r)=>"string"==typeof i&&t.has(i)?t.get(i):Reflect.get(t,i,r),set:(e,i,r,o)=>("string"!=typeof i||i in t?Reflect.set(t,i,r,o):t.set(i,r),!0)})}e.InertProxy=n,e.ReactiveProxyStore=class extends r{wrapFnValue(t){return t&&"function"==typeof t?(...e)=>t.call(a(this),...e):t}constructor(t){super(),this.store=new Map,this.tracing=!1,this.traced=new Set,this.lock=Promise.resolve();for(const[e,i]of Object.entries(t||{}))this.store.set(e,s.from(this.wrapFnValue(i)))}get $(){return a(this)}entries(){return this.store.entries()}get(t){var e;return this.tracing&&this.traced.add(t),null===(e=this.store.get(t))||void 0===e?void 0:e.get()}set(t,e){return i(this,void 0,void 0,(function*(){this.store.has(t)?yield this.store.get(t).set(this.wrapFnValue(e)):this.store.set(t,s.from(this.wrapFnValue(e)))}))}del(t){return this.store.delete(t)}has(t){return this.store.has(t)}update(t){return i(this,void 0,void 0,(function*(){yield Promise.all(Object.entries(t).map((([t,e])=>this.set(t,e))))}))}watch(t,e){(t=Array.isArray(t)?t:[t]).forEach((i=>this.store.get(i).watch((()=>e(...t.map((t=>this.store.get(t).get())))))))}trigger(t){return i(this,void 0,void 0,(function*(){t=Array.isArray(t)?t:[t],yield Promise.all(t.map((t=>this.store.get(t).trigger())))}))}trace(t){return i(this,void 0,void 0,(function*(){yield this.lock;const e=new Promise(((e,r)=>i(this,void 0,void 0,(function*(){this.traced.clear(),this.tracing=!0;try{const i=yield t(),r=Array.from(this.traced);e([i,r])}catch(t){r(t)}finally{this.tracing=!1,this.traced.clear()}}))));return this.lock=e.then((()=>{})),e}))}computed(t,e){return i(this,void 0,void 0,(function*(){const[r,o]=yield this.trace((()=>e.call(a(this))));this.watch(o,(()=>i(this,void 0,void 0,(function*(){return this.set(t,yield e.call(a(this)))})))),this.set(t,r)}))}},e.proxify=a}},e={};!function i(r){var o=e[r];if(void 0!==o)return o.exports;var s=e[r]={exports:{}};return t[r].call(s.exports,s,s.exports,i),s.exports}(246)})();