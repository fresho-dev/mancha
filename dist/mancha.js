(()=>{"use strict";var t={885:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.attributeNameToCamelCase=void 0,e.attributeNameToCamelCase=function(t){return t.replace(/-./g,(t=>t[1].toUpperCase()))}},283:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IRenderer=e.safeEval=e.makeEvalFunction=e.isRelativePath=e.dirname=e.traverse=void 0;const r=s(63),i=s(150),a=s(230);function*n(t,e=new Set){const s=new Set,r=Array.from(t.childNodes).filter((t=>!e.has(t)));for(yield t;r.length;){const t=r.pop();s.has(t)||(s.add(t),yield t),t.childNodes&&Array.from(t.childNodes).filter((t=>!e.has(t))).forEach((t=>r.push(t)))}}function o(t){return t.includes("/")?t.split("/").slice(0,-1).join("/"):""}function c(t,e={}){return new Function(...Object.keys(e),`with (this) { return (${t}); }`)}function l(t,e,s={}){const r=`with (this) { return (async () => (${e}))(); }`;return new Function(...Object.keys(s),r).call(t,...Object.values(s))}e.traverse=n,e.dirname=o,e.isRelativePath=function(t){return!(t.includes("://")||t.startsWith("/")||t.startsWith("#")||t.startsWith("data:"))},e.makeEvalFunction=c,e.safeEval=l;class h extends r.ReactiveProxyStore{debugging=!1;dirpath="";expressionCache=new Map;evalCallbacks=new Map;skipNodes=new Set;debug(t){return this.debugging=t,this}async fetchRemote(t,e){return fetch(t,{cache:e?.cache??"default"}).then((t=>t.text()))}async fetchLocal(t,e){return this.fetchRemote(t,e)}async preprocessString(t,e){this.log("Preprocessing string content with params:\n",e);const s=this.parseHTML(t,e);return await this.preprocessNode(s,e),s}async preprocessLocal(t,e){const s=await this.fetchLocal(t,e);return this.preprocessString(s,{...e,dirpath:o(t),root:e?.root??!t.endsWith(".tpl.html")})}async preprocessRemote(t,e){const s=e?.cache||"default",r=await fetch(t,{cache:s}).then((t=>t.text()));return this.preprocessString(r,{...e,dirpath:o(t),root:e?.root??!t.endsWith(".tpl.html")})}clone(){return new this.constructor(Object.fromEntries(this.store.entries()))}log(...t){this.debugging&&console.debug(...t)}cachedExpressionFunction(t,e){return this.expressionCache.has(t)||this.expressionCache.set(t,c(t,e)),this.expressionCache.get(t)?.call(this,...Object.values(e))}async eval(t,e={}){const[s,r]=await this.trace((async function(){return l(this,t,e)}));return this.log(`eval \`${t}\` => `,s,`[ ${r.join(", ")} ]`),[s,r]}async watchExpr(t,e,s){if(this.evalCallbacks.has(t))return this.evalCallbacks.get(t)?.push(s),this.eval(t,e).then((([t,e])=>s(t,e)));this.evalCallbacks.set(t,[s]);const r=[],i=async()=>{const[s,a]=await this.eval(t,e),n=this.evalCallbacks.get(t)||[];await Promise.all(n.map((t=>t(s,a)))),r.length>0&&this.unwatch(r,i),r.splice(0,r.length,...a),this.watch(a,i)};return i()}async preprocessNode(t,e){e=Object.assign({dirpath:this.dirpath,maxdepth:10},e);const s=new i.Iterator(n(t,this.skipNodes)).map((async t=>{this.log("Preprocessing node:\n",t),await a.RendererPlugins.resolveIncludes.call(this,t,e),await a.RendererPlugins.rebaseRelativePaths.call(this,t,e)}));await Promise.all(s.generator())}async renderNode(t,e){for(const s of n(t,this.skipNodes))this.log("Rendering node:\n",s),await a.RendererPlugins.resolveDataAttribute.call(this,s,e),await a.RendererPlugins.resolveForAttribute.call(this,s,e),await a.RendererPlugins.resolveHtmlAttribute.call(this,s,e),await a.RendererPlugins.resolveShowAttribute.call(this,s,e),await a.RendererPlugins.resolveWatchAttribute.call(this,s,e),await a.RendererPlugins.resolveBindAttribute.call(this,s,e),await a.RendererPlugins.resolvePropAttributes.call(this,s,e),await a.RendererPlugins.resolveAttrAttributes.call(this,s,e),await a.RendererPlugins.resolveEventAttributes.call(this,s,e),await a.RendererPlugins.resolveTextNodeExpressions.call(this,s,e)}async mount(t,e){await this.preprocessNode(t,e),await this.renderNode(t,e)}}e.IRenderer=h},150:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Iterator=void 0;class s{iterable;constructor(t){this.iterable=t}filter(t){return new s(s.filterGenerator(t,this.iterable))}map(t){return new s(s.mapGenerator(t,this.iterable))}array(){return Array.from(this.iterable)}*generator(){for(const t of this.iterable)yield t}static*filterGenerator(t,e){for(const s of e)t(s)&&(yield s)}static*mapGenerator(t,e){for(const s of e)yield t(s)}static equals(t,e){const s=t[Symbol.iterator](),r=e[Symbol.iterator]();let i=s.next(),a=r.next();for(;!i.done&&!a.done;){if(i.value!==a.value)return!1;i=s.next(),a=r.next()}return i.done===a.done}}e.Iterator=s},230:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RendererPlugins=void 0;const r=s(885),i=s(283),a=new Set([":bind",":bind-events",":data",":for",":show","@watch","$html"]),n={$text:"$text-content"};var o;!function(t){t.resolveIncludes=async function(t,e){const s=t;if("include"!==s.tagName?.toLocaleLowerCase())return;this.log("<include> tag found in:\n",t),this.log("<include> params:",e);const r=s.getAttribute?.("src");if(!r)throw new Error(`"src" attribute missing from ${t}.`);const i=e=>{t.replaceWith(...Array.from(e.childNodes))},a={...e,root:!1,maxdepth:e?.maxdepth-1};if(0===a.maxdepth)throw new Error("Maximum recursion depth reached.");if(r.includes("://")||r.startsWith("//"))this.log("Including remote file from absolute path:",r),await this.preprocessRemote(r,a).then(i);else if(e?.dirpath?.includes("://")||e?.dirpath?.startsWith("//")){const t=e.dirpath&&"."!==e.dirpath?`${e.dirpath}/${r}`:r;this.log("Including remote file from relative path:",t),await this.preprocessRemote(t,a).then(i)}else if("/"===r.charAt(0))this.log("Including local file from absolute path:",r),await this.preprocessLocal(r,a).then(i);else{const t=e?.dirpath&&"."!==e?.dirpath?`${e?.dirpath}/${r}`:r;this.log("Including local file from relative path:",t),await this.preprocessLocal(t,a).then(i)}},t.rebaseRelativePaths=async function(t,e){const s=t,r=s.tagName?.toLowerCase();if(!e?.dirpath)return;const a=t.getAttribute?.("src"),n=t.getAttribute?.("href"),o=t.getAttribute?.("data"),c=a||n||o;c&&(c&&(0,i.isRelativePath)(c)&&this.log("Rebasing relative path as:",e.dirpath,"/",c),"img"===r&&a&&(0,i.isRelativePath)(a)?s.src=`${e.dirpath}/${a}`:"a"===r&&n&&(0,i.isRelativePath)(n)||"link"===r&&n&&(0,i.isRelativePath)(n)?s.href=`${e.dirpath}/${n}`:"script"===r&&a&&(0,i.isRelativePath)(a)||"source"===r&&a&&(0,i.isRelativePath)(a)||"audio"===r&&a&&(0,i.isRelativePath)(a)||"video"===r&&a&&(0,i.isRelativePath)(a)||"track"===r&&a&&(0,i.isRelativePath)(a)||"iframe"===r&&a&&(0,i.isRelativePath)(a)?s.src=`${e.dirpath}/${a}`:"object"===r&&o&&(0,i.isRelativePath)(o)?s.data=`${e.dirpath}/${o}`:"input"===r&&a&&(0,i.isRelativePath)(a)?s.src=`${e.dirpath}/${a}`:("area"===r&&n&&(0,i.isRelativePath)(n)||"base"===r&&n&&(0,i.isRelativePath)(n))&&(s.href=`${e.dirpath}/${n}`))},t.resolveTextNodeExpressions=async function(t,e){if(3!==t.nodeType)return;const s=t.nodeValue||"";this.log("Processing node content value:\n",s);const r=new RegExp(/{{ ([^}]+) }}/gm),i=Array.from(s.matchAll(r)).map((t=>t[1])),a=async()=>{let e=s;for(const s of i){const[r]=await this.eval(s,{$elem:t});e=e.replace(`{{ ${s} }}`,String(r))}t.nodeValue=e};await Promise.all(i.map((e=>this.watchExpr(e,{$elem:t},a))))},t.resolveDataAttribute=async function(t,e){if(this.skipNodes.has(t))return;const s=t,r=s.getAttribute?.(":data");if(r){this.log(":data attribute found in:\n",t),s.removeAttribute(":data");const[e]=await this.eval(r,{$elem:t});await this.update(e)}},t.resolveWatchAttribute=async function(t,e){if(this.skipNodes.has(t))return;const s=t,r=s.getAttribute?.("@watch");r&&(this.log("@watch attribute found in:\n",t),s.removeAttribute("@watch"),await this.watchExpr(r,{$elem:t},(()=>{})))},t.resolveHtmlAttribute=async function(t,e){if(this.skipNodes.has(t))return;const s=t,r=s.getAttribute?.("$html");if(r){this.log("$html attribute found in:\n",t),s.removeAttribute("$html");const i=this.clone();await this.watchExpr(r,{$elem:t},(async t=>{const r=await i.preprocessString(t,e);await i.renderNode(r,e),s.replaceChildren(r)}))}},t.resolvePropAttributes=async function(t,e){if(this.skipNodes.has(t))return;const s=t;for(const e of Array.from(s.attributes||[]))if(e.name.startsWith("$")&&!a.has(e.name)){this.log(e.name,"attribute found in:\n",t),s.removeAttribute(e.name);const i=(n[e.name]||e.name).slice(1),a=(0,r.attributeNameToCamelCase)(i);await this.watchExpr(e.value,{$elem:t},(e=>t[a]=e))}},t.resolveAttrAttributes=async function(t,e){if(this.skipNodes.has(t))return;const s=t;for(const e of Array.from(s.attributes||[]))if(e.name.startsWith(":")&&!a.has(e.name)){this.log(e.name,"attribute found in:\n",t),s.removeAttribute(e.name);const r=(n[e.name]||e.name).slice(1);await this.watchExpr(e.value,{$elem:t},(t=>s.setAttribute(r,t)))}},t.resolveEventAttributes=async function(t,e){if(this.skipNodes.has(t))return;const s=t;for(const e of Array.from(s.attributes||[]))e.name.startsWith("@")&&!a.has(e.name)&&(this.log(e.name,"attribute found in:\n",t),s.removeAttribute(e.name),t.addEventListener?.(e.name.substring(1),(s=>{this.eval(e.value,{$elem:t,$event:s})})))},t.resolveForAttribute=async function(t,e){if(this.skipNodes.has(t))return;const s=t,r=s.getAttribute?.(":for")?.trim();if(r){this.log(":for attribute found in:\n",t),s.removeAttribute(":for");for(const e of(0,i.traverse)(t,this.skipNodes))this.skipNodes.add(e);const a=t.parentNode,n=t.ownerDocument.createElement("template");a.insertBefore(n,t),n.append(t),this.log(":for template:\n",n);const o=r.split(" in ",2);if(2!==o.length)throw new Error(`Invalid :for format: \`${r}\`. Expected "{key} in {expression}".`);const c=[],[l,h]=o;await this.watchExpr(h,{$elem:t},(s=>(this.log(":for list items:",s),this.lock=this.lock.then((()=>new Promise((async r=>{if(c.splice(0,c.length).forEach((t=>{a.removeChild(t),this.skipNodes.delete(t)})),!Array.isArray(s))return console.error(`Expression did not yield a list: \`${h}\` => \`${s}\``),r();for(const r of s.slice(0).reverse()){const s=this.clone();await s.set(l,r);const i=t.cloneNode(!0);a.insertBefore(i,n.nextSibling),c.push(i),this.skipNodes.add(i),await s.mount(i,e),this.log("Rendered list child:\n",i,i.outerHTML)}r()})))),this.lock)))}},t.resolveBindAttribute=async function(t,e){if(this.skipNodes.has(t))return;const s=t,r=s.getAttribute?.(":bind");if(r){this.log(":bind attribute found in:\n",t);const e=["change","input"],i=s.getAttribute?.(":bind-events")?.split(",")||e;s.removeAttribute(":bind"),s.removeAttribute(":bind-events");const a="checkbox"===s.getAttribute("type")?"checked":"value";this.has(r)||await this.set(r,s[a]),s[a]=this.get(r);for(const e of i)t.addEventListener(e,(()=>this.set(r,s[a])));this.watch([r],(()=>s[a]=this.get(r)))}},t.resolveShowAttribute=async function(t,e){if(this.skipNodes.has(t))return;const s=t,r=s.getAttribute?.(":show");if(r){this.log(":show attribute found in:\n",t),s.removeAttribute(":show");const e="none"===s.style.display?"":s.style.display;await this.watchExpr(r,{$elem:t},(t=>{s.style.display=t?e:"none"}))}}}(o||(e.RendererPlugins=o={}))},63:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.proxifyStore=e.ReactiveProxyStore=e.InertProxy=e.ReactiveProxy=e.proxifyObject=e.REACTIVE_DEBOUNCE_MILLIS=void 0;class s{timeouts=new Map;debounce(t,e){return new Promise(((s,r)=>{const i=this.timeouts.get(e);i&&clearTimeout(i),this.timeouts.set(e,setTimeout((()=>{try{s(e()),this.timeouts.delete(e)}catch(t){r(t)}}),t))}))}}function r(t,e,s=!0){if(null==t||function(t){return t instanceof i||t.__is_proxy__}(t))return t;if(s)for(const s in t)t.hasOwnProperty(s)&&"object"==typeof t[s]&&null!=t[s]&&(t[s]=r(t[s],e));return new Proxy(t,{deleteProperty:(t,s)=>s in t&&(delete t[s],e(),!0),set:(t,i,a,n)=>{s&&"object"==typeof a&&(a=r(a,e));const o=Reflect.set(t,i,a,n);return e(),o},get:(t,e,s)=>"__is_proxy__"===e||Reflect.get(t,e,s)})}e.REACTIVE_DEBOUNCE_MILLIS=25,e.proxifyObject=r;class i extends s{value=null;listeners=[];constructor(t=null,...e){super(),this.value=this.wrapObjValue(t),e.forEach((t=>this.watch(t)))}static from(t,...e){return t instanceof i?(e.forEach(t.watch),t):new i(t,...e)}wrapObjValue(t){return null===t||"object"!=typeof t?t:r(t,(()=>this.trigger()))}get(){return this.value}async set(t){if(this.value!==t){const e=this.value;this.value=this.wrapObjValue(t),await this.trigger(e)}}watch(t){this.listeners.push(t)}unwatch(t){this.listeners=this.listeners.filter((e=>e!==t))}trigger(t=null){const s=this.listeners.slice();return this.debounce(e.REACTIVE_DEBOUNCE_MILLIS,(()=>Promise.all(s.map((e=>e(this.value,t)))).then((()=>{}))))}}e.ReactiveProxy=i;class a extends i{static from(t,...e){return t instanceof i?t:new a(t,...e)}watch(t){}trigger(t){return Promise.resolve()}}function n(t,e=(()=>{})){const s=Array.from(t.entries()).map((([t])=>t)),r=Object.fromEntries(s.map((t=>[t,void 0])));return new Proxy(Object.assign({},t,r),{get:(s,r,i)=>"string"==typeof r&&t.has(r)?(e("get",r),t.get(r)):"get"===r?s=>(e("get",s),t.get(s)):Reflect.get(t,r,i),set:(s,r,i,a)=>("string"!=typeof r||r in t?Reflect.set(t,r,i,a):(e("set",r,i),t.set(r,i)),!0)})}e.InertProxy=a,e.ReactiveProxyStore=class extends s{store=new Map;debouncedListeners=new Map;lock=Promise.resolve();constructor(t){super();for(const[e,s]of Object.entries(t||{}))this.store.set(e,i.from(this.wrapFnValue(s)))}wrapFnValue(t){return t&&"function"==typeof t?(...e)=>t.call(n(this),...e):t}get $(){return n(this)}entries(){return this.store.entries()}get(t){return this.store.get(t)?.get()}async set(t,e){this.store.has(t)?await this.store.get(t).set(this.wrapFnValue(e)):this.store.set(t,i.from(this.wrapFnValue(e)))}del(t){return this.store.delete(t)}has(t){return this.store.has(t)}async update(t){await Promise.all(Object.entries(t).map((([t,e])=>this.set(t,e))))}watch(t,s){t=Array.isArray(t)?t:[t];const r=()=>s(...t.map((t=>this.store.get(t).get()))),i=()=>this.debounce(e.REACTIVE_DEBOUNCE_MILLIS,r);t.forEach((t=>this.store.get(t).watch(i))),this.debouncedListeners.set(s,i)}unwatch(t,e){(t=Array.isArray(t)?t:[t]).forEach((t=>this.store.get(t).unwatch(this.debouncedListeners.get(e)))),this.debouncedListeners.delete(e)}async trigger(t){t=Array.isArray(t)?t:[t],await Promise.all(t.map((t=>this.store.get(t).trigger())))}async trace(t){const e=new Set,s=n(this,((t,s)=>{"get"===t&&e.add(s)}));return[await t.call(s),Array.from(e)]}async computed(t,e){const[s,r]=await this.trace(e);this.watch(r,(async()=>this.set(t,await e.call(n(this))))),this.set(t,s)}},e.proxifyStore=n}},e={};function s(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,s),a.exports}(()=>{const t=s(283);class e extends t.IRenderer{dirpath=(0,t.dirname)(self.location.href);parseHTML(t,e={root:!1}){if(e.root)return(new DOMParser).parseFromString(t,"text/html");{const e=document.createRange();return e.selectNodeContents(document.body),e.createContextualFragment(t)}}serializeHTML(t){return(new XMLSerializer).serializeToString(t).replace(/\s?xmlns="[^"]+"/gm,"")}preprocessLocal(t,e){return this.preprocessRemote(t,e)}}const r=new e;self.Mancha=r;const i=self.document?.currentScript;if(self.document?.currentScript?.hasAttribute("init")){r.update({...i?.dataset});const t=i?.hasAttribute("debug"),e=i?.getAttribute("cache");(i?.getAttribute("target")?.split(",")||["body"]).map((async s=>{const i=self.document.querySelector(s);await r.debug(t).mount(i,{cache:e})}))}})()})();